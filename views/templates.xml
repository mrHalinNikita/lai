<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="lai_calculator_page" name="LAI Calculator Page">
        <t t-call="website.layout">
            <div class="lai-apple-wrapper">
                <div class="lai-apple-container">
                    <div class="lai-card">
                        <div class="lai-header mb-5 text-center">
                            <h1 class="lai-title">LAI Estimator</h1>
                        </div>

                        <form action="/lai-calculate" method="POST" enctype="multipart/form-data" class="lai-upload-form">
                            <div class="mb-5">
                                <label class="lai-label">Field Image</label>
                                <input type="file" class="lai-file-input" name="image" accept="image/*" required="1"/>
                            </div>

                            <div class="mb-5">
                                <label class="lai-label">Crop Type</label>
                                <div class="lai-crop-buttons">
                                    <t t-foreach="[
                                        ('wheat', 'Wheat'),
                                        ('corn', 'Corn'),
                                        ('sunflower', 'Sunflower'),
                                        ('mixed', 'Mixed')
                                    ]" t-as="crop">
                                        <input type="radio" name="crop_type" t-att-id="crop[0]" t-att-value="crop[0]" t-att-checked="crop[0] == 'wheat'"/>
                                        <label t-att-for="crop[0]" class="lai-crop-btn" t-esc="crop[1]"/>
                                    </t>
                                </div>
                            </div>

                            <div class="text-center">
                                <button type="submit" class="lai-submit-btn">
                                    <span>Calculate LAI</span>
                                </button>
                            </div>
                        </form>

                        <t t-if="request and request.params.get('error')">
                            <div class="lai-error mt-4 text-center">
                                <p>Error: <t t-esc="request.params.get('error')"/></p>
                            </div>
                        </t>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <template id="lai_result_page" name="LAI Result Page">
        <t t-call="website.layout">
            <div class="lai-apple-wrapper">
                <div class="lai-apple-container">
                    <div class="lai-card">
                        <div class="lai-header mb-5 text-center">
                            <h1 class="lai-title">LAI Analysis Complete</h1>
                        </div>

                        <div class="lai-result-summary mb-5 text-center">
                            <div class="lai-lai-value">LAI <span t-esc="calc.lai_avg"/></div>
                            <p class="lai-meta">
                                <span t-esc="dict(calc._fields['crop_type'].selection).get(calc.crop_type)"/>
                                • 
                                <span t-esc="calc.date_calculated" t-options="{'widget': 'datetime'}"/>
                            </p>
                        </div>

                        <div class="lai-image-grid mb-5">
                            <div class="lai-image-item">
                                <div class="lai-image-label">Original</div>
                                <div class="lai-image-frame">
                                    <img t-att-src="'/web/image?model=lai.calculation&amp;field=image&amp;id=' + str(calc.id)"
                                         alt="Original field image"/>
                                </div>
                            </div>
                            <div class="lai-image-item">
                                <div class="lai-image-label">Heatmap</div>
                                <div class="lai-image-frame">
                                    <img t-att-src="'/web/image?model=lai.calculation&amp;field=lai_heatmap&amp;id=' + str(calc.id)"
                                         alt="LAI heatmap"/>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <a t-att-href="'/web/content?model=lai.calculation&amp;field=lai_heatmap&amp;id=' + str(calc.id) + '&amp;download=true&amp;filename=' + (calc.lai_heatmap_filename or 'lai_heatmap.png')"
                               class="lai-download-btn">
                                Download Heatmap
                            </a>
                            <a href="/lai-calculator" class="lai-back-btn mt-3 d-inline-block">
                                ← New Analysis
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

</odoo>